---
title: "ç æ‰é‡ç·´ React Router å…¨é¢å‡ç´š"
excerpt: "é€™å€‹åœ˜éšŠçœŸçš„ä¸æ–·åœ¨æ›´æ–°ï¼Œä¸Šæ¬¡æ‰å‡ç´šç¬¬å…­ç‰ˆï¼Œæ²’æƒ³åˆ°é¦¬ä¸Šåˆè¿ä¾†ä¸€æ¬¡å…¨é¢å‡ç´šã€‚ä½†æ˜¯ä¸å¾—ä¸èªªï¼Œé€™æ¬¡æ”¹ç‰ˆç¢ºå¯¦æ–°å¢äº†è¨±å¤šåŠŸèƒ½ï¼Œå…¶ä¸­ Loader æ˜¯è®“æˆ‘æœ€é©šè±”çš„åŠŸèƒ½ï¼Œå¾ˆå€¼å¾—çµ¦å®ƒå‡ç´šä¸€æ³¢ã€‚"
tags: ["React", "React Router"]
date: "2023-03-01"
---

å»¢è©±ä¸å¤šèªªï¼Œæˆ‘å€‘é‡æ–°é–‹å§‹å§ï¼Œå¾å»ºç«‹è·¯ç”±é–‹å§‹ â‹¯â‹¯ ( ê™¬)ğŸ¥•

## è³‡æ–™å¤¾çµæ§‹ - Folder Structure

> è²æ˜ï¼šä»¥ä¸‹å‘½åæˆ‘ OK ä½ éš¨æ„ã€‚

é¦–å…ˆï¼Œä½ çš„ React å°ˆæ¡ˆå…§æœƒæœ‰ä¸€å€‹ `src` è³‡æ–™å¤¾ï¼Œç¬¬ä¸€å±¤è£¡é¢çš„ `App.js(x)` æˆ–æ˜¯ `main.js(x)` å°±æ˜¯ä½ çš„é€²å…¥é» (Entry)ã€‚

ç„¶å¾Œï¼Œåœ¨ `src` ä¸‹å»ºç«‹åç‚º `pages` æˆ–æ˜¯ `routes` çš„è³‡æ–™å¤¾ï¼Œç”¨é€”ç‚ºæ”¾ç½® Page-Level Componentsã€‚

## å»ºç«‹è·¯ç”± - createBrowserRouter

æ‰“é–‹é€²å…¥é»çš„æª”æ¡ˆï¼Œæˆ‘å€‘è¦åœ¨é€™è£¡å®£å‘Šè·¯ç”±ã€‚

é€é `createBrowserRouter()` æ–¹æ³•ï¼Œå‚³å…¥ç”±ç‰©ä»¶æ‰€çµ„æˆçš„é™£åˆ—ï¼Œæ¯å€‹ç‰©ä»¶å°±æ˜¯ä¸€çµ„è·¯ç”±ï¼Œæœ€å¾ŒæŠŠå›å‚³çš„å€¼ç”¨ `router` æ¥èµ·ä¾†ï¼Œå‚³å…¥ `RouterProvider`ã€‚

```javascript
import { createBrowserRouter, RouterProvider } from "react-router-dom";

import HomePage from "@/routes/Home";
import ProductsPage from "@/routes/Products";

const router = createBrowserRouter([
  { path: "/", element: <HomePage /> },
  { path: "/products", element: <ProductsPage /> },
]);

ReactDOM.createRoot(document.getElementById("root")).render(
  <React.StrictMode>
    <RouterProvider router={router} />
  </React.StrictMode>,
);
```

è£œå……ä¸€ä¸‹ï¼Œæœ‰äº›äººæœƒæŠŠé€™å€‹ `App.js(x)` åªç•¶ä½œå®£å‘Šè·¯ç”±çš„å…ƒä»¶ï¼Œå†æŠŠ `RouterProvider` åŒ¯å‡ºå»çµ¦é¡å¤–çš„é€²å…¥é»åƒæ˜¯ `index.js(x)` ä½¿ç”¨ï¼Œæ•ˆæœéƒ½æ˜¯ä¸€æ¨£çš„ï¼Œæˆ‘åªæ˜¯ä¸æƒ³è¦æœ‰é‚£éº¼å¤šæª”æ¡ˆã€‚

> è‡³æ–¼å¦ä¸€ç¨®å»ºç«‹æ–¹æ³• `createRoutesFromElement` æˆ‘è¦ºå¾—å¯«èµ·ä¾†å¾ˆå†—é•·ï¼Œè·Ÿä»¥å‰ä½¿ç”¨ JSX çš„å¯«æ³•å¾ˆåƒï¼Œå€‹äººä¸å–œæ­¡æ‰€ä»¥å°±ä¸ä»‹ç´¹äº†ã€‚

## è·¯ç”±éˆçµ - Link èˆ‡ NavLink

å¦‚ä½•åˆ‡æ›é€™äº›è·¯ç”±ï¼Œé”åˆ°æ›é çš„ä½œç”¨å‘¢ï¼Ÿæˆ‘å€‘ä¸æ˜¯ä½¿ç”¨åŸç”Ÿçš„ `<a>` æ¨™ç±¤è€Œæ˜¯ä½¿ç”¨ React Router æä¾›çš„ `<Link>` ä¾†è·³è½‰é é¢ã€‚

```javascript
import { Link, NavLink } from "react-router-dom";

<Link to="/products">Products Page</Link>;
```

é‚„æœ‰å¦ä¸€ç¨®æ˜¯ `<NavLink>`ï¼Œä½œç”¨ä¸€æ¨£ï¼Œä½†æ˜¯å…§å»ºæä¾›äº† `isActive`èˆ‡`isPending` å…©å€‹ç‹€æ…‹ï¼Œä½ å¯ä»¥æŠŠä»–å€‘è§£æ§‹å‡ºä¾†ï¼Œç”¨æ–¼åˆ¤æ–·è·¯ç”±çš„ç‹€æ…‹ï¼Œä¸¦ä¸”å‹•æ…‹åœ°è™•ç†æ¨£å¼ã€‚

```javascript
const getNavLinkClass = ({ isActive, isPending }) => {
  if (isActive) {
    return "active";
  }
  if (isPending) {
    return "pending";
  }
  return "";
};

<NavLink to="/products" className={getNavLinkClass}>
  Products Page
</NavLink>;
```

åœ¨ `<NavLink>` ä½¿ç”¨ `end` é€™å€‹ prop çš„è©±ï¼Œæœƒç¢ºä¿é€™ä¸€å€‹ NavLink ä¸æœƒå› ç‚ºé€²å…¥å­è·¯ç”±ï¼Œè€Œ Match åˆ° `isActive` ç­‰ç‹€æ…‹ã€‚

ä¾‹å¦‚ï¼š

- Home åªæœƒå°æ‡‰åˆ°ç¶²ç«™çš„ Root Route (`'/'`) ä¹Ÿå°±æ˜¯å¾Œé¢ä¸å¸¶ä»»ä½•è·¯å¾‘çš„æ™‚å€™
- Blog åªæœƒå°æ‡‰åˆ° `/blog`ï¼Œç•¶é€²å…¥ `/blog/hello-world` é é¢æ™‚ä¸æœƒæœ‰ `isActive` ç‹€æ…‹

```javascript
<NavLink to="/" end>Home</NavLink>
<NavLink to="/blog" end>Blog</NavLink>
<NavLink to={`/blog/hello-world`}>Hello World</NavLink>
```

## Root Layout - children èˆ‡ Outlet

ä¸€å€‹ç¶²ç«™é€šå¸¸æœƒæœ‰ä¸€å€‹å…±ç”¨çš„å¤–æ¡†ï¼Œåƒæ˜¯ä¸Šæ–¹æˆ–å·¦å´çš„å°è¦½åˆ—ã€ç¶²ç«™çš„å•†æ¨™ã€é å°¾çš„ç‰ˆæ¬Šå®£å‘Šç­‰ç­‰ï¼Œé€™äº›å…§å®¹æœƒå…¨éƒ¨æ”¾åœ¨ä¸€å€‹ Layout å…ƒä»¶ç•¶ä¸­ã€‚

è·¯ç”±é…ç½®ä¸Šï¼Œé€™å€‹ Layout å°±æ˜¯ä¸€å€‹ Parent Routeï¼Œè—‰ç”± `children` å¯ä»¥å»é…ç½®è£¡é¢çš„å­é é¢ï¼Œä¹Ÿå°±æ˜¯ Children Routesã€‚

```javascript
const router = createBrowserRouter([
  {
    path: "/",
    element: <RootLayout />,
    children: [
      { path: "/", element: <HomePage /> },
      { path: "/products", element: <ProductsPage /> },
    ],
  },
]);
```

ä»¥ä¸‹æ˜¯ä¸€å€‹ç°¡æ˜“çš„ Layout å…ƒä»¶ï¼Œå­é é¢ `children` çš„å…§å®¹æœƒé¡¯ç¤ºåœ¨ `<Outlet />` çš„ä½ç½®ã€‚

```javascript
import { Outlet } from "react-router-dom";

const RootLayout = () => {
  return (
    <>
      <h1>Root Layout</h1>
      <Outlet />
    </>
  );
};

export default RootLayout;
```

## éŒ¯èª¤é é¢ - errorElement

å¦‚æœé€²å…¥ä¸€å€‹æ²’æœ‰è¢«å®šç¾©çš„è·¯ç”±ï¼Œç•¶ç„¶å°±æœƒå‡ºç¾ 404 çš„ç•«é¢ï¼Œä¸Šé¢å¯èƒ½æœƒæœ‰ä¸€äº›éŒ¯èª¤è¨Šæ¯ç­‰ç­‰ã€‚é€šå¸¸ä½ ä¸æœƒæƒ³è¦ç›´æ¥ç”¨ React Router å¹«ä½ åšçš„ Error é é¢ï¼Œå› æ­¤æˆ‘å€‘ä¾†æ–°å¢è‡ªå·±çš„ Error Pageã€‚

```javascript
import { useRouteError } from "react-router-dom";

const ErrorPage = () => {
  const error = useRouteError();
  console.error(error);

  return (
    <div id="error-page">
      <h1>Oops!</h1>
      <p>Sorry, an unexpected error has occurred.</p>
      <p>
        <i>{error.statusText || error.message}</i>
      </p>
    </div>
  );
};

export default ErrorPage;
```

åœ¨å®Œæˆä¸€å€‹ç°¡å–®çš„ 404 é é¢å¾Œï¼Œå¯ä»¥é€é `errorElement` ä¾†é…ç½®é€™å€‹éŒ¯èª¤è™•ç†çš„å°ˆå±¬é é¢ã€‚

```javascript
const router = createBrowserRouter([
  {
    path: "/",
    element: <RootLayout />,
    errorElement: <ErrorPage />, // catch any errors
    children: [
      { path: "/", element: <HomePage /> },
      { path: "/products", element: <ProductsPage /> },
    ],
  },
]);
```
