---
title: "全面升級：重新學習 React Router"
excerpt: "React Router 團隊最近又來一次全面升級，新增了許多功能，特別是 Loader 功能讓人驚豔。他們的文件也寫得相當好，基本上跟著一遍 Tutorial 就能掌握 React Router V6 的大致功能。"
tags: ["React", "React Router"]
date: "2023-03-01"
---

不多說，讓我們重新開始，就從建立路由開始吧 ⋯⋯ ( Ꙭ)🥕

## 資料夾結構 - Folder Structure

首先，你的 React 專案會有一個 `src` 資料夾，裡面的 `App.js(x)` 或 `main.js(x)` 就是你的進入點 (Entry)。

接下來，在 `src` 下建立名為 `pages` 或 `routes` 的資料夾，用途是放置 Page-Level Components。

## 建立路由 - createBrowserRouter

在進入點檔案中，我們需要宣告路由。透過 `createBrowserRouter()` 方法，傳入由物件組成的陣列，每個物件就是一組路由，最後把回傳的值用 `router` 接起來，傳入 `RouterProvider。`

```javascript
import { createBrowserRouter, RouterProvider } from "react-router-dom";
import HomePage from "@/routes/Home";
import ProductsPage from "@/routes/Products";

const router = createBrowserRouter([
  { path: "/", element: <HomePage /> },
  { path: "/products", element: <ProductsPage /> },
]);

ReactDOM.createRoot(document.getElementById("root")).render(
  <React.StrictMode>
    <RouterProvider router={router} />
  </React.StrictMode>,
);
```

補充一下，有些人會把這個 `App.js(x)` 只當作宣告路由的元件，再把 `RouterProvider` 匯出去給額外的進入點像是 `index.js(x)` 使用，效果都是一樣的，我只是不想要有那麼多檔案。

> 至於另一種建立方法 `createRoutesFromElement` 較為冗長，跟以前使用 JSX 的寫法相似，這裡不予介紹。

## 路由鏈結 - Link 與 NavLink

在 React Router 中，要實現頁面跳轉的功能，我們並不使用原生的 `<a>` 標籤，而是使用 React Router 提供的 `<Link>` 元件。

```javascript
import { Link, NavLink } from "react-router-dom";
<Link to="/products">Products Page</Link>;
```

還有另一種路由鏈結是 `<NavLink>`，它與 `<Link>` 的作用相同，但內建了 `isActive` 和 `isPending` 兩個狀態屬性。你可以將它們解構出來，用於判斷當前路由的狀態，並動態地設置樣式。

```javascript
const getNavLinkClass = ({ isActive, isPending }) => {
  if (isActive) {
    return "active";
  }
  if (isPending) {
    return "pending";
  }
  return "";
};

<NavLink to="/products" className={getNavLinkClass}>
  Products Page
</NavLink>;
```

在 `<NavLink>` 使用 `end` 屬性，可以確保該元件不會在進入子路由時，被匹配為 `isActive` 等狀態。

例如：

- Home 只會對應到網站的根路由 (`'/'`)，也就是後面不帶任何路徑時
- Blog 只會對應到 `/blog`，當進入 `/blog/hello-world` 頁面時不會有 `isActive` 狀態

```javascript
<NavLink to="/" end>Home</NavLink>
<NavLink to="/blog" end>Blog</NavLink>
<NavLink to={`/blog/hello-world`}>Hello World</NavLink>
```

## 共用外框 - children 與 Outlet

一個網站通常會有一個共用的外框，例如上方或左側的導覽列、商標、版權宣告等等，這些內容會全部放在一個 Layout 元件當中。

在路由配置中，這個 Root Layout 元件就是一個父路由，使用 `children` 配置子頁面，即子路由。

```javascript
const router = createBrowserRouter([
  {
    path: "/",
    element: <RootLayout />,
    children: [
      { path: "/", element: <HomePage /> },
      { path: "/products", element: <ProductsPage /> },
    ],
  },
]);
```

以下是一個簡單的 Layout 元件，子頁面 `children` 的內容會顯示在 `<Outlet />` 這個輸出點的位置。

```javascript
import { Outlet } from "react-router-dom";

const RootLayout = () => {
  return (
    <>
      <h1>Root Layout</h1>
      <Outlet />
    </>
  );
};

export default RootLayout;
```

## 錯誤頁面 - errorElement

如果進入一個未定義的路由，通常會顯示 404 錯誤頁面，上面可能會有一些錯誤訊息。但通常你不會想要直接使用 React Router 內建的錯誤頁面，因此我們來建立自己的錯誤頁面。

```javascript
import { useRouteError } from "react-router-dom";

const ErrorPage = () => {
  const error = useRouteError();
  console.error(error);

  return (
    <div id="error-page">
      <h1>Oops!</h1>
      <p>Sorry, an unexpected error has occurred.</p>
      <p>
        <i>{error.statusText || error.message}</i>
      </p>
    </div>
  );
};

export default ErrorPage;
```

完成了這個簡單的 404 頁面後，可以透過 `errorElement` 來配置這個錯誤處理的專屬頁面。

```javascript
const router = createBrowserRouter([
  {
    path: "/",
    element: <RootLayout />,
    errorElement: <ErrorPage />, // catch any errors
    children: [
      { path: "/", element: <HomePage /> },
      { path: "/products", element: <ProductsPage /> },
    ],
  },
]);
```

## 程式化導頁 - useNavigate

除了使用 Link 來換頁，我們也可以手動執行路由跳轉的動作，例如在表單送出或按下按鈕後導頁。

透過 `react-router-dom` 提供的 `useNavigate` 函式，就可以執行程式化導頁。

```javascript
import { useNavigate } from "react-router-dom";

const Home = ({ film }) => {
  const navigate = useNavigate();

  const handleNavigate = () => {
    navigate("/products");
  };

  return (
    <div>
      <button onClick={handleNavigate}>前往產品頁面</button>
    </div>
  );
};
```
